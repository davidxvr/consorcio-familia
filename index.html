<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Cons√≥rcio Familiar 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
    <style>
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        .highlight-month {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(251, 191, 36, 0.08) 100%);
            border-left: 4px solid #fbbf24;
            font-weight: 600;
        }
        
        .card-expand {
            transition: all 0.3s ease;
        }
        
        .card-expand.expanded {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* Sticky column para desktop */
        @media (min-width: 768px) {
            .sticky-col {
                position: sticky;
                left: 0;
                background-color: white;
                z-index: 10;
            }
            
            tbody .sticky-col {
                background-color: inherit;
            }
            
            tbody tr:nth-child(odd) .sticky-col {
                background-color: #f9fafb;
            }
        }
        
        /* Scrollbar customizado */
        .overflow-x-auto::-webkit-scrollbar {
            height: 6px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-6 px-4">
    <div class="container mx-auto max-w-7xl">
        <!-- Cabe√ßalho -->
        <header class="text-center mb-8 fade-in">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-10 h-10 text-indigo-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h1 class="text-3xl md:text-4xl font-bold text-indigo-900">Cons√≥rcio Familiar 2026</h1>
            </div>
            <p class="text-gray-600 text-sm md:text-base">Acompanhamento mensal de pagamentos</p>
        </header>

        <!-- Loading State -->
        <div id="loadingState" class="bg-white rounded-lg shadow-lg p-8 mb-6 text-center fade-in">
            <div class="flex flex-col items-center justify-center">
                <svg class="w-12 h-12 text-indigo-600 mb-4 spinner" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <p class="text-gray-600 font-medium">Carregando dados...</p>
            </div>
        </div>

        <!-- Contador e Barra de Pesquisa -->
        <div id="mainContent" class="hidden">
            <div class="grid md:grid-cols-2 gap-4 mb-6">
                <!-- Contador -->
                <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-lg shadow-lg p-6 fade-in transform hover:scale-105 transition">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-xs md:text-sm uppercase tracking-widest font-semibold opacity-90 mb-2">M√™s Atual (Fevereiro)</p>
                            <p class="text-4xl md:text-5xl font-bold"><span id="currentPaid">0</span>/<span id="totalExpected">0</span></p>
                            <p class="text-xs md:text-sm mt-2 opacity-90">Pagamentos Realizados</p>
                        </div>
                        <svg class="w-12 h-12 opacity-30" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"></path>
                        </svg>
                    </div>
                </div>

                <!-- Barra de Pesquisa -->
                <div class="bg-white rounded-lg shadow-lg p-6 fade-in">
                    <label for="searchInput" class="block text-sm font-semibold text-gray-700 mb-3">
                        üîç Filtrar por nome
                    </label>
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Digite o nome..."
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition text-sm"
                    >
                    <p class="text-xs text-gray-500 mt-2" id="resultCount"></p>
                </div>
            </div>

            <!-- View Toggle (Desktop/Mobile) -->
            <div class="flex gap-3 mb-6 fade-in">
                <button id="viewTableBtn" class="flex-1 md:flex-initial px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold text-sm hover:bg-indigo-700 transition shadow-lg">
                    üìä Tabela
                </button>
                <button id="viewCardsBtn" class="flex-1 md:flex-initial px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300 transition md:hidden">
                    üÉè Cards
                </button>
            </div>

            <!-- Vista Tabela -->
            <div id="tableView" class="bg-white rounded-lg shadow-lg overflow-hidden fade-in">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm" id="consortiumTable">
                        <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                            <tr>
                                <th class="sticky-col px-4 py-4 text-left font-semibold text-xs md:text-sm">Nome</th>
                                <th class="px-3 py-4 text-center font-semibold text-xs">M√™s</th>
                                <th class="px-3 py-4 text-center font-semibold text-xs">PIX</th>
                                <th class="px-3 py-4 text-center font-semibold text-xs">Valor</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Jan</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Fev</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Mar</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Abr</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Mai</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Jun</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Jul</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Ago</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Set</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Out</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Nov</th>
                                <th class="px-2 py-4 text-center font-semibold text-xs">Dez</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-gray-200">
                            <!-- Conte√∫do ser√° inserido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Vista Cards -->
            <div id="cardsView" class="hidden md:hidden space-y-4 fade-in">
                <div id="cardsContainer">
                    <!-- Cards ser√£o inseridos via JavaScript -->
                </div>
            </div>

            <!-- Rodap√© -->
            <footer class="text-center mt-8 py-6 text-gray-600 fade-in">
                <p class="text-sm">√öltima atualiza√ß√£o: <span id="lastUpdate" class="font-semibold text-indigo-600">-</span></p>
                <p class="text-xs mt-2 text-gray-500">Desenvolvido com ‚ù§Ô∏è para a Fam√≠lia</p>
            </footer>
        </div>
    </div>

    <script>
        let consortiumData = [];
        const monthsNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const monthsAbbr = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

        // Dados padr√£o em caso de falha ao carregar CSV
        const defaultData = `Nome;Mes_Recebimento;PIX;Valor;Janeiro;Fevereiro;Mar√ßo;Abril;Maio;Junho;Julho;Agosto;Setembro;Outubro;Novembro;Dezembro
David;3;123.456.789-00;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
D√≠via;2;987.654.321-00;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Flavio;4;111.222.333-44;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Ivo;5;555.666.777-88;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Lilian;6;999.000.111-22;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Luzia;7;444.555.666-77;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Fabr√≠cio;8;333.444.555-66;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Luiz;9;222.333.444-55;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Roberto;10;666.777.888-99;1500.00;V;X;X;X;X;X;X;X;X;X;X;X
Confra;11;777.888.999-00;1500.00;V;X;X;X;X;X;X;X;X;X;X;X`;

        // Fun√ß√£o para detectar delimitador do CSV
        function detectDelimiter(csvContent) {
            const firstLine = csvContent.split('\n')[0];
            if (firstLine.includes(';')) return ';';
            if (firstLine.includes(',')) return ',';
            return ';'; // padr√£o
        }

        // Processar dados CSV
        function parseCSVData(csvContent) {
            const delimiter = detectDelimiter(csvContent);
            
            Papa.parse(csvContent, {
                header: true,
                delimiter: delimiter,
                skipEmptyLines: true,
                complete: function(results) {
                    consortiumData = results.data
                        .filter(row => row.Nome && row.Nome.trim() !== '')
                        .sort((a, b) => {
                            const mesA = parseInt(a.Mes_Recebimento) || 12;
                            const mesB = parseInt(b.Mes_Recebimento) || 12;
                            return mesA - mesB;
                        });
                    
                    hideLoading();
                    renderTable(consortiumData);
                    renderCards(consortiumData);
                    updateMonthCounter();
                    updateLastUpdate();
                    updateResultCount();
                },
                error: function(error) {
                    console.error('Erro ao parsear CSV:', error);
                    // Tentar carregar dados padr√£o como fallback
                    parseCSVData(defaultData);
                }
            });
        }

        // Carregar dados do CSV com suporte a m√∫ltiplos delimitadores
        function loadCSV() {
            // Tentar carregar do arquivo primeiro com cache busting
            const timestamp = new Date().getTime();
            fetch(`dados.csv?v=${timestamp}`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.text();
                })
                .then(csvContent => {
                    parseCSVData(csvContent);
                })
                .catch(error => {
                    console.error('Erro ao buscar arquivo CSV:', error);
                    console.log('Usando dados padr√£o como fallback...');
                    // Usar dados padr√£o em caso de erro
                    parseCSVData(defaultData);
                });
        }

        // Mostrar/esconder loading
        function hideLoading() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('loadingState').innerHTML = `
                <div class="text-center">
                    <svg class="w-12 h-12 text-red-600 mb-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-red-600 font-semibold">${message}</p>
                </div>
            `;
        }

        // Renderizar tabela
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" class="text-center py-8 text-gray-600">Nenhum resultado encontrado</td></tr>';
                return;
            }

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = `hover:bg-indigo-50 transition ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}`;
                
                const mesRecebimento = parseInt(row.Mes_Recebimento) || 12;
                const nomeMes = monthsNames[mesRecebimento - 1];
                
                let html = `<td class="sticky-col px-4 py-4 font-semibold text-gray-900 text-xs md:text-sm">${row.Nome}</td>`;
                html += `<td class="px-3 py-4 text-center text-xs font-medium text-indigo-600 bg-indigo-50 rounded">${mesRecebimento}</td>`;
                html += `<td class="px-3 py-4 text-center text-xs font-mono text-gray-700">${row.PIX || '-'}</td>`;
                html += `<td class="px-3 py-4 text-center text-xs font-semibold text-green-600">R$ ${row.Valor || '-'}</td>`;
                
                monthsNames.forEach((month, monthIndex) => {
                    const value = row[month] ? row[month].trim().toUpperCase() : '';
                    const isReceiptMonth = monthIndex === (mesRecebimento - 1);
                    let cellContent = '-';
                    let cellClass = 'px-2 py-4 text-center text-sm font-semibold';
                    
                    if (isReceiptMonth) {
                        cellClass += ' highlight-month';
                    }
                    
                    if (value === 'V') {
                        cellContent = '<svg class="w-5 h-5 text-green-500 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>';
                    } else if (value === 'X') {
                        cellContent = '<svg class="w-5 h-5 text-red-500 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>';
                    }
                    
                    html += `<td class="${cellClass}">${cellContent}</td>`;
                });
                
                tr.innerHTML = html;
                tbody.appendChild(tr);
            });
        }

        // Renderizar cards para mobile
        function renderCards(data) {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-600 py-8">Nenhum resultado encontrado</p>';
                return;
            }

            data.forEach((row) => {
                const mesRecebimento = parseInt(row.Mes_Recebimento) || 12;
                const nomeMes = monthsNames[mesRecebimento - 1];
                
                let cardHTML = `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden card-expand border-l-4 border-indigo-500">
                        <div class="p-4 cursor-pointer hover:bg-gray-50 transition" onclick="this.parentElement.classList.toggle('expanded'); this.nextElementSibling.classList.toggle('hidden')">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h3 class="font-bold text-lg text-gray-900">${row.Nome}</h3>
                                    <p class="text-sm text-indigo-600 font-semibold">üìÖ M√™s: ${mesRecebimento} (${nomeMes})</p>
                                    <p class="text-sm text-green-600 font-semibold mt-1">üí∞ Valor: R$ ${row.Valor || '-'}</p>
                                    <p class="text-xs text-gray-600 mt-1 font-mono">üì± PIX: ${row.PIX || '-'}</p>
                                </div>
                                <svg class="w-6 h-6 text-gray-400 transform transition" style="transform: rotate(0deg)">
                                    <path fill="none" stroke="currentColor" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </div>
                        </div>
                        <div class="hidden px-4 pb-4 border-t border-gray-200">
                            <p class="text-xs font-semibold text-gray-600 mt-3 mb-2">Pagamentos:</p>
                            <div class="grid grid-cols-3 gap-3 mt-4">
                `;
                
                monthsNames.forEach((month, monthIndex) => {
                    const value = row[month] ? row[month].trim().toUpperCase() : '';
                    const isReceiptMonth = monthIndex === (mesRecebimento - 1);
                    let icon = '‚Äî';
                    let bgColor = 'bg-gray-100';
                    
                    if (value === 'V') {
                        icon = '‚úì';
                        bgColor = 'bg-green-100';
                    } else if (value === 'X') {
                        icon = '‚úó';
                        bgColor = 'bg-red-100';
                    }
                    
                    const highlight = isReceiptMonth ? 'ring-2 ring-yellow-400 ring-offset-1' : '';
                    
                    cardHTML += `
                        <div class="text-center ${bgColor} rounded-lg p-2 ${highlight}">
                            <p class="text-xs font-semibold text-gray-700">${monthsAbbr[monthIndex]}</p>
                            <p class="text-lg font-bold ${value === 'V' ? 'text-green-600' : value === 'X' ? 'text-red-600' : 'text-gray-500'}">${icon}</p>
                        </div>
                    `;
                });
                
                cardHTML += `
                            </div>
                        </div>
                    </div>
                `;
                
                const cardElement = document.createElement('div');
                cardElement.innerHTML = cardHTML;
                container.appendChild(cardElement.firstElementChild);
            });
        }

        // Atualizar contador do m√™s atual
        function updateMonthCounter() {
            const currentMonth = new Date().getMonth();
            const currentMonthName = monthsNames[currentMonth];
            
            let paidCount = 0;
            const totalExpected = consortiumData.length;
            
            consortiumData.forEach(row => {
                const value = row[currentMonthName] ? row[currentMonthName].trim().toUpperCase() : '';
                if (value === 'V') {
                    paidCount++;
                }
            });
            
            document.getElementById('currentPaid').textContent = paidCount;
            document.getElementById('totalExpected').textContent = totalExpected;
        }

        // Atualizar data da √∫ltima atualiza√ß√£o
        function updateLastUpdate() {
            const now = new Date();
            const formatted = now.toLocaleDateString('pt-BR', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = formatted;
        }

        // Atualizar contador de resultados
        function updateResultCount() {
            const count = consortiumData.length;
            document.getElementById('resultCount').textContent = `${count} pessoa${count !== 1 ? 's' : ''} cadastrada${count !== 1 ? 's' : ''}`;
        }

        // Filtro de pesquisa
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = consortiumData.filter(row => 
                row.Nome.toLowerCase().includes(searchTerm)
            );
            renderTable(filteredData);
            renderCards(filteredData);
        });

        // Toggle entre vista tabela e cards (mobile)
        document.getElementById('viewTableBtn').addEventListener('click', function() {
            document.getElementById('tableView').classList.remove('hidden');
            document.getElementById('cardsView').classList.add('hidden');
            document.getElementById('viewTableBtn').classList.add('bg-indigo-600', 'text-white');
            document.getElementById('viewTableBtn').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('viewCardsBtn').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('viewCardsBtn').classList.add('bg-gray-200', 'text-gray-700');
        });

        document.getElementById('viewCardsBtn').addEventListener('click', function() {
            document.getElementById('tableView').classList.add('hidden');
            document.getElementById('cardsView').classList.remove('hidden');
            document.getElementById('viewCardsBtn').classList.add('bg-indigo-600', 'text-white');
            document.getElementById('viewCardsBtn').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('viewTableBtn').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('viewTableBtn').classList.add('bg-gray-200', 'text-gray-700');
        });

        // Carregar dados ao iniciar
        loadCSV();
    </script>
</body>
</html>